# 登录记录功能说明

## 功能概述

现在系统已经实现了完整的计算记录追踪功能，**无论是否登录，所有计算结果都会自动保存**。

## 工作原理

### 1. 自动保存机制

每次在"碳足迹计算"页面完成计算后，系统会：
- ✅ **自动保存**计算记录到本地存储
- ✅ 显示绿色通知提示"记录已保存"
- ✅ 提供链接直接跳转到"个人记录"页面查看

### 2. 两种记录模式

#### 访客模式（未登录）
- 记录保存到 `guestRecords`
- 在"个人记录"页面显示为"访客"
- 页面顶部显示蓝色提示：建议登录以绑定记录

#### 用户模式（已登录）
- 记录保存到 `userRecords`
- 自动关联用户的学号和姓名
- 在"个人记录"页面按用户筛选显示
- 管理员可在后台查看所有用户记录

### 3. 记录内容

每条记录包含：
- 📅 **时间戳**：计算的日期和时间
- 👤 **用户信息**：学号和姓名（登录用户）或"访客"
- 🚗/🍽️ **活动类型**：交通或食品
- 📊 **详细数据**：
  - 选项1：类型、数量、排放量
  - 选项2：类型、数量、排放量
  - 总排放量
  - 节约量

## 使用流程

### 场景1：访客使用
```
1. 打开网站 → 碳足迹计算
2. 选择交通方式或食品类型
3. 点击"开始计算"
4. 看到结果 + 绿色通知"记录已保存（访客模式）"
5. 点击导航栏"个人记录"查看历史
```

### 场景2：登录用户
```
1. 先登录（或注册）
2. 进入碳足迹计算页面
3. 进行计算
4. 看到通知"记录已保存！"
5. 在个人记录页面查看自己的所有历史记录
```

### 场景3：管理员查看
```
1. 访问 admin.html
2. 使用管理员账号登录（王榆腾/351027）
3. 查看所有用户的统计数据
4. 导出CSV报表分析
```

## 数据存储

### LocalStorage 结构
```javascript
{
  "userInfo": {                    // 当前登录用户信息
    "studentId": "20251001",
    "name": "张三"
  },
  "guestRecords": [                // 访客记录数组
    {
      "activityType": "transportation",
      "option1": "bus",
      "option1Label": "公交车",
      "option1Amount": 10,
      "option1Emission": 0.89,
      "option2": "subway",
      "option2Label": "地铁",
      "option2Amount": 10,
      "option2Emission": 0.41,
      "totalEmission": 1.3,
      "savings": 0.48,
      "timestamp": "2025-11-29T10:30:00.000Z"
    }
  ],
  "userRecords": [                 // 用户记录数组
    {
      "studentId": "20251001",
      "userName": "张三",
      "activityType": "diet",
      // ... 其他字段同上
    }
  ]
}
```

## 查看记录的方式

### 1. 个人记录页面
- **URL**: `records.html`
- **访客模式**: 显示所有访客记录
- **用户模式**: 只显示当前用户的记录
- **功能**: 
  - 按时间倒序排列
  - 显示详细的计算数据
  - 统计总记录数、总排放量、平均排放量

### 2. 管理员后台
- **URL**: `admin.html`
- **访问权限**: 仅管理员（王榆腾/351027）
- **功能**:
  - 查看所有用户统计
  - 查看访客统计
  - 导出所有数据为CSV

## 特色功能

### 1. 实时通知
计算完成后右上角显示绿色通知卡片：
- ✅ 提示记录已保存
- 🔗 提供直接查看链接
- ⏱️ 4秒后自动消失
- 🎨 流畅的滑入滑出动画

### 2. 智能提示
- 访客用户在"个人记录"页面会看到蓝色提示框
- 建议登录以获得更好的体验
- 一键跳转到登录页面

### 3. 数据安全
- 所有数据保存在用户浏览器的LocalStorage
- 不会上传到服务器
- 用户完全控制自己的数据
- 可通过清除浏览器数据删除记录

## 测试步骤

### 测试1：访客记录
1. 打开浏览器隐私模式
2. 访问网站
3. 进入计算器，完成一次计算
4. 查看是否显示保存通知
5. 点击"个人记录"，确认记录显示

### 测试2：用户记录
1. 注册/登录一个账号
2. 完成多次计算（交通和食品各至少一次）
3. 查看"个人记录"页面
4. 确认所有记录都显示且与当前用户关联

### 测试3：管理员查看
1. 访问 `admin.html`
2. 使用 王榆腾/351027 登录
3. 查看统计数据
4. 点击"导出班级数据"
5. 打开CSV文件验证数据完整性

## 注意事项

1. **浏览器兼容性**: 使用LocalStorage，需要现代浏览器支持
2. **数据持久性**: 数据保存在浏览器，清除缓存会丢失
3. **访客限制**: 访客记录不跨设备同步
4. **登录优势**: 建议用户登录以获得更好的数据管理体验

## 更新日志

**2025-11-29**
- ✅ 实现自动保存功能
- ✅ 添加保存成功通知
- ✅ 优化个人记录页面显示
- ✅ 添加访客模式支持
- ✅ 管理员后台完善
