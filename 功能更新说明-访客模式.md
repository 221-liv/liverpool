# 功能更新说明 - 访客模式与记录系统

## 🎉 更新概览

### 核心改进
1. **个人记录页面** - 无需登录即可访问（访客模式）
2. **自动保存记录** - 计算结果自动保存到本地
3. **登录功能保留** - 登录后记录绑定到用户账户
4. **管理员查看** - 可查看所有用户和访客的记录

---

## 📱 使用流程

### 方式1：访客模式（推荐快速体验）

```
访问计算器 → 进行计算 → 自动保存 → 查看记录
http://localhost:8080/calculator.html
```

**特点**：
- ✅ 无需登录，立即使用
- ✅ 记录自动保存在浏览器本地
- ✅ 可随时查看个人记录
- ⚠️ 记录仅限当前浏览器

**流程**：
1. 打开 [计算器](http://localhost:8080/calculator.html)
2. 选择交通方式或食品类型，输入数量
3. 点击"开始计算"
4. 结果自动保存到本地
5. 访问 [个人记录](http://localhost:8080/records.html) 查看历史

---

### 方式2：登录模式（推荐长期使用）

```
登录账户 → 进行计算 → 绑定记录 → 跨设备同步
http://localhost:8080/login.html
```

**特点**：
- ✅ 记录绑定到学号账户
- ✅ 支持多设备访问（同一浏览器）
- ✅ 管理员可查看个人数据
- ✅ 数据更加安全

**流程**：
1. 打开 [登录页面](http://localhost:8080/login.html)
2. 输入姓名和学号
3. 登录成功后返回首页
4. 在计算器中进行计算
5. 记录自动绑定到您的账户

---

## 🔄 访客与登录的对比

| 功能 | 访客模式 | 登录模式 |
|------|---------|---------|
| 是否需要登录 | ❌ 不需要 | ✅ 需要 |
| 记录保存 | ✅ 本地浏览器 | ✅ 本地+账户绑定 |
| 查看记录 | ✅ 可以 | ✅ 可以 |
| 管理员可见 | ✅ 显示为"访客" | ✅ 显示姓名学号 |
| 跨设备访问 | ❌ 不支持 | ⚠️ 有限支持* |
| 数据导出 | ✅ 包含在导出中 | ✅ 包含在导出中 |

*注：目前使用localStorage，仅限同一浏览器同一设备

---

## 💾 记录保存机制

### 访客模式
- **保存位置**：`localStorage.guestRecords`
- **数据标识**：学号显示为"访客"
- **适用场景**：快速体验、临时使用

### 登录模式
- **保存位置**：`localStorage.userRecords`
- **数据标识**：包含姓名和学号
- **适用场景**：长期使用、班级统计

### 数据结构
```javascript
{
    activityType: "transportation", // 或 "diet"
    option1: "car_medium",
    option1Label: "中型汽车(1.6-2.5L)",
    option1Amount: 10,
    option1Emission: 1.72,
    option2: "subway",
    option2Label: "地铁/轻轨",
    option2Amount: 10,
    option2Emission: 0.41,
    totalEmission: 2.13,
    savings: 1.31,
    timestamp: "2025-11-29T12:00:00.000Z",
    studentId: "202512345", // 登录用户有，访客为undefined
    userName: "张三"        // 登录用户有，访客为undefined
}
```

---

## 👨‍💼 管理员功能

### 登录管理后台

访问：http://localhost:8080/admin.html

**默认账号**：
- 用户名：`admin` 或 `teacher`
- 密码：`251025`

### 功能说明

#### 1. 数据总览
- **总用户数**：包含已登录用户数 + 访客（如有记录）
- **总记录数**：所有计算记录的总和
- **总碳排放量**：所有记录的排放量总和
- **平均碳排放量**：平均每条记录的排放量

#### 2. 用户列表
显示所有有记录的用户（包括访客）：
- 排名（按总排放量）
- 姓名
- 学号
- 总碳排放量（及节约量）
- 最后更新时间

#### 3. 数据导出
点击"导出班级数据(CSV)"按钮可导出完整数据，包含：
- 时间、学号、姓名
- 活动类型（交通/食品）
- 选项1和选项2的详细信息
- 总排放量和节约量

**导出文件名格式**：`碳足迹数据_2025-11-29.csv`

---

## 🎯 使用示例

### 示例1：访客快速体验

**张三同学**（未登录）：
1. 打开计算器
2. 计算：开车10公里 vs 地铁10公里
3. 结果：节约1.31kg CO₂e
4. 自动保存到访客记录
5. 访问个人记录页面查看

**管理员视角**：
- 用户列表中显示"访客用户"
- 可看到访客的所有记录
- 导出数据时学号列显示"访客"

---

### 示例2：登录使用

**李四同学**（学号202512345）：
1. 访问登录页面
2. 输入：姓名"李四"，学号"202512345"
3. 登录成功
4. 在计算器中计算：牛肉1kg vs 鸡肉1kg
5. 结果：节约21.0kg CO₂e
6. 记录自动绑定到学号

**管理员视角**：
- 用户列表显示"李四 - 202512345"
- 可看到该用户的所有记录
- 导出时包含完整的学号和姓名

---

### 示例3：从访客切换到登录

**王五同学**：
1. 访客模式下计算了5条记录
2. 决定登录：输入姓名和学号
3. 登录后继续计算
4. 新记录绑定到账户

**结果**：
- 访客记录仍然存在（独立保存）
- 登录后的记录绑定到王五账户
- 管理员可以看到两份数据

⚠️ **注意**：访客记录不会自动合并到登录账户，它们是独立的

---

## 🔐 数据安全说明

### 存储方式
- **技术**：浏览器 LocalStorage
- **位置**：本地浏览器缓存
- **持久性**：除非手动清除，否则永久保存

### 隐私保护
- ✅ 数据仅存储在本地，不上传服务器
- ✅ 访客模式无需提供个人信息
- ✅ 登录仅需姓名和学号（无密码）
- ⚠️ 清除浏览器缓存会丢失所有数据

### 管理员权限
- 管理员登录：用户名+密码验证
- 数据查看：仅当前浏览器存储的数据
- 导出功能：CSV格式，可用Excel打开

---

## 📊 数据统计

### 个人记录页面统计
- 总记录数
- 总碳排放量
- 平均每次排放量
- 详细记录表格（按时间倒序）

### 管理员页面统计
- 全班用户数（含访客）
- 全班总记录数
- 全班总碳排放量
- 全班平均排放量
- 用户排名（按总排放量）

---

## 🚀 快速测试

### 测试访客模式
1. 打开计算器（无需登录）
2. 计算：中型汽车10km vs 地铁10km
3. 访问个人记录页面
4. 应该看到：提示"访客模式"，显示刚才的记录

### 测试登录模式
1. 访问登录页面
2. 输入：姓名"测试"，学号"000000"
3. 登录成功后访问计算器
4. 计算：牛肉1kg vs 鸡肉1kg
5. 访问个人记录页面
6. 应该看到：显示"测试的碳足迹记录"，显示刚才的记录

### 测试管理员功能
1. 访问管理员页面
2. 登录：用户名`admin`，密码`251025`
3. 应该看到：
   - 用户统计（包含访客和登录用户）
   - 用户列表
   - 可以导出CSV数据

---

## 🎨 界面提示

### 个人记录页面
**访客模式**显示：
```
个人碳足迹记录（访客模式）
[蓝色提示框] 提示：您当前使用访客模式，记录仅保存在本地浏览器中。
点击登录后可将记录绑定到您的账户。
```

**登录模式**显示：
```
张三的碳足迹记录
[正常显示，无特殊提示]
```

### 记录表格
| 列名 | 访客模式 | 登录模式 |
|------|---------|---------|
| 学号 | "访客" | "202512345" |
| 其他列 | 正常显示 | 正常显示 |

---

## 💡 使用建议

### 给学生
- **首次使用**：先用访客模式体验
- **长期使用**：登录后使用，便于数据管理
- **数据保护**：不要清除浏览器缓存

### 给管理员
- **定期导出**：每周或每月导出数据备份
- **数据分析**：用Excel打开CSV进行统计分析
- **隐私保护**：导出数据仅供教学使用，注意保密

---

## 🔧 技术细节

### LocalStorage键名
- `userInfo` - 当前登录用户信息
- `userRecords` - 登录用户的记录
- `guestRecords` - 访客的记录

### 浏览器兼容性
- ✅ Chrome 4+
- ✅ Firefox 3.5+
- ✅ Safari 4+
- ✅ Edge 所有版本
- ✅ IE 8+

### 数据容量
- LocalStorage限制：约5-10MB
- 单条记录大小：约0.5KB
- 可存储记录数：约10,000-20,000条

---

## ❓ 常见问题

### Q1: 访客记录会丢失吗？
A: 除非清除浏览器缓存或使用隐私模式，否则访客记录会一直保存。

### Q2: 登录后访客记录会消失吗？
A: 不会。访客记录和登录用户记录是分开保存的。

### Q3: 可以在不同浏览器查看记录吗？
A: 不可以。记录保存在浏览器本地，不同浏览器之间不共享。

### Q4: 管理员能看到我的详细计算过程吗？
A: 可以。管理员可以看到所有记录的详细信息（选项、数量、排放量等）。

### Q5: 如何备份我的数据？
A: 管理员可以导出CSV文件。个人用户建议登录使用，并定期截图保存。

### Q6: 密码是什么？
A: 普通用户登录不需要密码，只需姓名和学号。管理员密码为`251025`。

---

## 📝 更新日志

**2025-11-29**
- ✅ 个人记录页面改为访客模式（无需登录）
- ✅ 计算器自动保存记录功能
- ✅ 区分访客记录和用户记录
- ✅ 管理员页面可查看所有记录
- ✅ 数据导出功能完善

---

## 🎯 后续计划

- [ ] 添加记录删除功能
- [ ] 添加数据同步到云端功能
- [ ] 添加更详细的数据分析图表
- [ ] 添加记录搜索和筛选功能
- [ ] 优化移动端显示

---

*最后更新：2025-11-29*  
*版本：v2.0 - 访客模式*
