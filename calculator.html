<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>碳足迹计算 - 25-10矿大能动</title>
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- 内联关键脚本确保功能正常 -->
    <script>
        // 防止脚本加载失败导致功能不可用，提供内联备用实现
        window.INLINE_MODE = false; // 默认使用外部脚本
        
        // 如果外部脚本加载失败，会自动切换到内联模式
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT') {
                console.warn('外部脚本加载失败，准备使用内联备用方案');
                window.INLINE_MODE = true;
            }
        }, true);
    </script>
    
    <!-- 按顺序加载外部脚本 -->
    <script src="js/constants.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/footprint-calculator.js"></script>
    <script src="js/main.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>碳足迹计算器</h1>
            <div class="class-info">25-10矿大能动</div>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="index.html">首页</a></li>
                <li><a href="calculator.html" class="active">碳足迹计算</a></li>
                <li><a href="records.html">个人记录</a></li>
                <li><a href="ranking.html">班级排名</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <h2>碳足迹对比计算</h2>
        <p>通过对比不同的活动选择，了解您的碳减排潜力</p>
        
        <!-- 计算类型选择 -->
        <div class="calculator-type-selector">
            <button id="transport-tab" class="tab-button active">交通方式</button>
            <button id="food-tab" class="tab-button">食品消费</button>
        </div>
        
        <!-- 交通方式计算 -->
        <div id="transport-section" class="calculator-section active">
            <div class="calculator-container">
                <!-- 选项1 -->
                <div class="calculator-card">
                    <h3>选项 1</h3>
                    <div class="form-group">
                        <label for="transport-type-1">交通方式</label>
                        <select id="transport-type-1" required>
                            <option value="walking">步行</option>
                            <option value="cycling">骑自行车</option>
                            <option value="subway">地铁/轻轨</option>
                            <option value="bus">公交车</option>
                            <option value="train">高铁/动车</option>
                            <option value="motorcycle">摩托车</option>
                            <option value="car_small">小型汽车(1.0-1.6L)</option>
                            <option value="taxi">出租车</option>
                            <option value="car_medium" selected>中型汽车(1.6-2.5L)</option>
                            <option value="car_large">大型汽车/SUV(2.5L+)</option>
                            <option value="plane_international">国际航班</option>
                            <option value="plane_domestic">国内航班</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="distance-1">距离 (公里)</label>
                        <input type="number" id="distance-1" min="0" step="0.1" value="10" required>
                    </div>
                </div>
                
                <!-- 选项2 -->
                <div class="calculator-card">
                    <h3>选项 2</h3>
                    <div class="form-group">
                        <label for="transport-type-2">交通方式</label>
                        <select id="transport-type-2" required>
                            <option value="walking">步行</option>
                            <option value="cycling">骑自行车</option>
                            <option value="subway" selected>地铁/轻轨</option>
                            <option value="bus">公交车</option>
                            <option value="train">高铁/动车</option>
                            <option value="motorcycle">摩托车</option>
                            <option value="car_small">小型汽车(1.0-1.6L)</option>
                            <option value="taxi">出租车</option>
                            <option value="car_medium">中型汽车(1.6-2.5L)</option>
                            <option value="car_large">大型汽车/SUV(2.5L+)</option>
                            <option value="plane_international">国际航班</option>
                            <option value="plane_domestic">国内航班</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="distance-2">距离 (公里)</label>
                        <input type="number" id="distance-2" min="0" step="0.1" value="10" required>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 食品消费计算 -->
        <div id="food-section" class="calculator-section" style="display: none;">
            <div class="calculator-container">
                <!-- 选项1 -->
                <div class="calculator-card">
                    <h3>选项 1</h3>
                    <div class="form-group">
                        <label for="food-type-1">食品类型</label>
                        <select id="food-type-1" required>
                            <option value="beef" selected>牛肉</option>
                            <option value="lamb">羊肉</option>
                            <option value="pork">猪肉</option>
                            <option value="chicken">鸡肉</option>
                            <option value="fish">鱼肉</option>
                            <option value="eggs">鸡蛋</option>
                            <option value="milk">牛奶</option>
                            <option value="rice">米饭</option>
                            <option value="wheat">小麦</option>
                            <option value="tomato">番茄(露天)</option>
                            <option value="lettuce">生菜(露天)</option>
                            <option value="vegetables">蔬菜(平均)</option>
                            <option value="fruits">水果(平均)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="food-amount-1">消费量 (公斤)</label>
                        <input type="number" id="food-amount-1" min="0" step="0.1" value="1" required>
                    </div>
                </div>
                
                <!-- 选项2 -->
                <div class="calculator-card">
                    <h3>选项 2</h3>
                    <div class="form-group">
                        <label for="food-type-2">食品类型</label>
                        <select id="food-type-2" required>
                            <option value="beef">牛肉</option>
                            <option value="lamb">羊肉</option>
                            <option value="pork">猪肉</option>
                            <option value="chicken" selected>鸡肉</option>
                            <option value="fish">鱼肉</option>
                            <option value="eggs">鸡蛋</option>
                            <option value="milk">牛奶</option>
                            <option value="rice">米饭</option>
                            <option value="wheat">小麦</option>
                            <option value="tomato">番茄(露天)</option>
                            <option value="lettuce">生菜(露天)</option>
                            <option value="vegetables">蔬菜(平均)</option>
                            <option value="fruits">水果(平均)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="food-amount-2">消费量 (公斤)</label>
                        <input type="number" id="food-amount-2" min="0" step="0.1" value="1" required>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 计算按钮 -->
        <div class="calculator-actions">
            <button id="calculate-btn" class="primary-button">开始计算</button>
        </div>
        
        <!-- 结果展示区域 -->
        <div id="results-section" class=\"results-section\" style=\"display: none;\">
            <h3>计算结果</h3>
            
            <!-- 选项对比 -->
            <div class=\"comparison-results\">
                <div class=\"result-item\">
                    <h4 id=\"option1-name\">选项 1</h4>
                    <div class=\"emission-value\" id=\"option1-emission\">0 kg CO₂e</div>
                </div>
                <div class=\"result-item\">
                    <h4 id=\"option2-name\">选项 2</h4>
                    <div class=\"emission-value\" id=\"option2-emission\">0 kg CO₂e</div>
                </div>
            </div>
            
            <!-- 减排效果 -->
            <div class=\"savings-result\">
                <div class=\"savings-item\">
                    <span class=\"label\">碳减排量:</span>
                    <span class=\"value\" id=\"carbon-saved\">0 kg CO₂e</span>
                </div>
                <div class=\"savings-item\">
                    <span class=\"label\">相当于种植树木:</span>
                    <span class=\"value\" id=\"trees-saved\">0 棵</span>
                </div>
            </div>
            
            <!-- 牛肉碳足迹构成分析（仅在选择牛肉时显示） -->
            <div id=\"beef-breakdown\" class=\"beef-breakdown-section\" style=\"display: none;\">
                <h4>🐄 牛肉碳足迹构成分析</h4>
                <p class=\"breakdown-intro\">牛肉的碳足迹为每公斤约27kg CO₂e，是所有常见肉类中最高的。以下是其碳排放的主要来源：</p>
                <div class=\"breakdown-chart\">
                    <!-- JavaScript 动态填充柱状图 -->
                </div>
                <div class=\"breakdown-explanation\">
                    <h5>主要排放来源说明：</h5>
                    <ul>
                        <li><strong>肠道发酵 (40%)</strong>：牛在消化过程中会通过打嗝排放大量甲烷，甲烷的温室效应是二氧化碳的25倍</li>
                        <li><strong>饲料生产 (26%)</strong>：种植饲料需要大量土地、水资源和化肥，养一头牛需要消耗8-10公斤饲料</li>
                        <li><strong>粪便管理 (10%)</strong>：牛粪在储存和处理过程中会释放甲烷和氧化亚氮</li>
                        <li><strong>其他环节 (24%)</strong>：包括农场能源使用、加工、运输和零售等环节</li>
                    </ul>
                    <p class=\"reduction-suggestion\">💡 <strong>减排建议</strong>：减少牛肉消费，选择鸡肉（6 kg CO₂e/kg）或植物蛋白，每周少吃一次牛肉可减少约27kg碳排放。</p>
                </div>
            </div>
            
            <!-- 环保建议 -->
            <div class=\"reduction-tips\">
                <h4>环保建议</h4>
                <ul id=\"reduction-tips\">
                    <!-- JavaScript 动态填充 -->
                </ul>
            </div>
            
            <!-- 记录保存 -->
            <div class=\"save-record\">
                <div class=\"form-group\">
                    <label for=\"record-notes\">备注 (可选)</label>
                    <textarea id=\"record-notes\" rows=\"3\" placeholder=\"添加记录备注...\"></textarea>
                </div>
                <button id=\"save-btn\" class=\"secondary-button\" disabled>保存记录</button>
            </div>
        </div>
        
        <!-- 环保知识 -->
        <div class="environmental-info">
            <h3>📚 交通碳足迹知识</h3>
            <div style="margin-bottom: 20px;">
                <h4>🚶 零碳出行方式</h4>
                <p><strong>步行和骑自行车</strong>是完全零碳排放的绿色出行方式。5公里以内的短途出行，建议优先选择步行或骑行，不仅环保，还能锻炼身体。</p>
            </div>
            <div style="margin-bottom: 20px;">
                <h4>🚇 低碳公共交通</h4>
                <p><strong>地铁/轻轨</strong>（0.041 kg CO₂e/km）和<strong>高铁/动车</strong>（0.041 kg CO₂e/km）是效率最高、排放最低的机动化交通方式。<strong>公交车</strong>虽然排放略高（0.089 kg CO₂e/km），但通过共乘大幅降低人均排放，仍是环保的选择。</p>
            </div>
            <div style="margin-bottom: 20px;">
                <h4>🚗 私家车碳排放对比</h4>
                <ul>
                    <li><strong>小型汽车</strong>（1.0-1.6L）：0.122 kg CO₂e/km</li>
                    <li><strong>中型汽车</strong>（1.6-2.5L）：0.172 kg CO₂e/km</li>
                    <li><strong>大型汽车/SUV</strong>（2.5L+）：0.221 kg CO₂e/km</li>
                    <li><strong>出租车</strong>：0.159 kg CO₂e/km（因空驶率高达40%）</li>
                </ul>
                <p>💡 <strong>建议</strong>：如必须开车，选择小排量车型，尽量拼车出行可将人均排放降低50%-75%。</p>
            </div>
            <div style="margin-bottom: 20px;">
                <h4>✈️ 航空出行碳排放</h4>
                <p><strong>国内航班</strong>（0.255 kg CO₂e/km）和<strong>国际航班</strong>（0.195 kg CO₂e/km）的碳排放远高于其他交通方式。一次北京-上海往返航班（约2,400km）排放约612kg CO₂e，相当于一辆小型汽车行驶5,000公里。</p>
                <p>💡 <strong>减排建议</strong>：1,000公里以内优先选择高铁；长途航班考虑购买碳抵消；商务出行可用视频会议替代部分差旅。</p>
            </div>
        </div>
        
        <!-- 数据来源 -->
        <div class="data-sources">
            <h3>数据来源与可靠性</h3>
            <p>本计算器使用的碳排放数据主要来源于：</p>
            <ul>
                <li><strong>IPCC</strong> (政府间气候变化专门委员会) 第五次和第六次评估报告</li>
                <li><strong>英国DEFRA</strong> (环境、食品与农村事务部) 2023年温室气体转换因子</li>
                <li><strong>中国环境科学学会</strong>碳排放核算标准</li>
                <li><strong>世界资源研究所</strong> (WRI) 温室气体核算体系</li>
                <li><strong>联合国粮农组织</strong> (FAO) 食品碳足迹数据库</li>
            </ul>
            <p><strong>数据说明</strong>：碳排放系数会因地区、燃料类型、车辆新旧程度、载客率等因素存在差异。本计算器采用的是中国典型场景下的平均值，实际碳足迹可能上下浮动15-30%。</p>
            <p><strong>计算方法</strong>：碳排放量 = 活动数据（如行驶距离）× 排放因子。排放因子单位为kg CO₂e（二氧化碳当量），已包含CO₂、CH₄、N₂O等温室气体的综合影响。</p>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 碳足迹计算器 - 25-10矿大能动</p>
        </div>
    </footer>
    
    <!-- 备用内联脚本 - 当外部脚本加载失败时启用 -->
    <script>
        // 延迟500ms检查外部脚本是否加载成功
        setTimeout(function() {
            // 如果Calculator类不存在，说明外部脚本加载失败，启用备用方案
            if (typeof window.Calculator === 'undefined' || window.INLINE_MODE) {
                console.warn('⚠️ 检测到外部脚本未加载，启用备用内联脚本');
                
                // 定义排放因子
                const FACTORS = {
                    transportation: {
                        walking: 0, cycling: 0, bus: 0.089, subway: 0.041, taxi: 0.159,
                        car_small: 0.122, car_medium: 0.172, car_large: 0.221,
                        motorcycle: 0.091, train: 0.041, plane_domestic: 0.255, plane_international: 0.195
                    },
                    diet: {
                        beef: 27.0, lamb: 24.5, pork: 12.0, chicken: 6.0, fish: 5.4,
                        eggs: 4.8, milk: 3.0, rice: 3.0, wheat: 2.5, tomato: 1.75, lettuce: 0.75,
                        broccoli: 2.8, carrot: 1.1, apple: 0.8, banana: 0.7, vegetables: 2.0, fruits: 1.1, grains: 2.7
                    }
                };
                
                const LABELS = {
                    transportation: {
                        walking: '步行', cycling: '骑自行车', bus: '公交车', subway: '地铁/轻轨',
                        taxi: '出租车', car_small: '小型汽车(1.0-1.6L)', car_medium: '中型汽车(1.6-2.5L)',
                        car_large: '大型汽车/SUV(2.5L+)', motorcycle: '摩托车', train: '高铁/动车',
                        plane_domestic: '国内航班', plane_international: '国际航班'
                    },
                    diet: {
                        beef: '牛肉', lamb: '羊肉', pork: '猪肉', chicken: '鸡肉', fish: '鱼肉',
                        eggs: '鸡蛋', milk: '牛奶', rice: '米饭', wheat: '小麦', tomato: '番茄',
                        lettuce: '生菜', vegetables: '蔬菜', fruits: '水果', grains: '谷物'
                    }
                };
                
                let currentTab = 'transport';
                
                // 绑定标签切换
                const transportTab = document.getElementById('transport-tab');
                const foodTab = document.getElementById('food-tab');
                const transportSection = document.getElementById('transport-section');
                const foodSection = document.getElementById('food-section');
                
                if (transportTab) {
                    transportTab.addEventListener('click', function() {
                        currentTab = 'transport';
                        transportTab.classList.add('active');
                        foodTab.classList.remove('active');
                        transportSection.style.display = 'block';
                        foodSection.style.display = 'none';
                        document.getElementById('results-section').style.display = 'none';
                    });
                }
                
                if (foodTab) {
                    foodTab.addEventListener('click', function() {
                        currentTab = 'food';
                        foodTab.classList.add('active');
                        transportTab.classList.remove('active');
                        foodSection.style.display = 'block';
                        transportSection.style.display = 'none';
                        document.getElementById('results-section').style.display = 'none';
                    });
                }
                
                // 绑定计算按钮
                const calculateBtn = document.getElementById('calculate-btn');
                if (calculateBtn) {
                    console.log('✅ 备用脚本：绑定计算按钮');
                    calculateBtn.addEventListener('click', function() {
                        console.log('🔵 备用脚本：计算按钮被点击，当前标签:', currentTab);
                        
                        try {
                            let type, item1, amount1, item2, amount2;
                            
                            if (currentTab === 'transport') {
                                type = 'transportation';
                                item1 = document.getElementById('transport-type-1').value;
                                amount1 = parseFloat(document.getElementById('distance-1').value) || 0;
                                item2 = document.getElementById('transport-type-2').value;
                                amount2 = parseFloat(document.getElementById('distance-2').value) || 0;
                            } else {
                                type = 'diet';
                                item1 = document.getElementById('food-type-1').value;
                                amount1 = parseFloat(document.getElementById('food-amount-1').value) || 0;
                                item2 = document.getElementById('food-type-2').value;
                                amount2 = parseFloat(document.getElementById('food-amount-2').value) || 0;
                            }
                            
                            const factor1 = FACTORS[type][item1];
                            const factor2 = FACTORS[type][item2];
                            const emission1 = amount1 * factor1;
                            const emission2 = amount2 * factor2;
                            const savings = Math.abs(emission1 - emission2);
                            const trees = (savings / 21.77).toFixed(2);
                            
                            // 显示结果
                            document.getElementById('option1-name').textContent = LABELS[type][item1];
                            document.getElementById('option2-name').textContent = LABELS[type][item2];
                            document.getElementById('option1-emission').textContent = emission1.toFixed(3) + ' kg CO₂e';
                            document.getElementById('option2-emission').textContent = emission2.toFixed(3) + ' kg CO₂e';
                            document.getElementById('carbon-saved').textContent = savings.toFixed(3) + ' kg CO₂e';
                            document.getElementById('trees-saved').textContent = trees + ' 棵';
                            
                            // 生成建议
                            const tips = [];
                            if (currentTab === 'transport') {
                                if (emission1 > 1 || emission2 > 1) {
                                    tips.push('短途出行（5km以内）建议步行或骑自行车');
                                    tips.push('中长途出行优先选择地铁、公交等公共交通');
                                }
                                if (emission1 > 2 || emission2 > 2) {
                                    tips.push('如必须开车，尽量选择小排量车型并拼车');
                                    tips.push('1000公里以内优先选择高铁，碳排放仅为飞机的1/6');
                                }
                                if (factor1 === 0 || factor2 === 0) {
                                    tips.push('您已选择零碳出行方式，为保护地球做出了贡献！');
                                }
                            } else {
                                if (item1 === 'beef' || item2 === 'beef') {
                                    tips.push('牛肉的碳足迹非常高(27kg CO₂e/kg)，减少牛肉消费可显著降低碳排放');
                                }
                                tips.push('增加植物性食品比例，减少红肉消费');
                                tips.push('选择本地生产的食物，减少运输碳足迹');
                            }
                            
                            const tipsList = document.getElementById('reduction-tips');
                            tipsList.innerHTML = tips.map(tip => '<li>' + tip + '</li>').join('');
                            
                            document.getElementById('results-section').style.display = 'block';
                            document.getElementById('results-section').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            
                            console.log('✅ 备用脚本：计算完成');
                        } catch (error) {
                            console.error('❌ 备用脚本计算出错:', error);
                            alert('计算出错: ' + error.message);
                        }
                    });
                } else {
                    console.error('❌ 备用脚本：未找到计算按钮');
                }
            } else {
                console.log('✅ 外部脚本加载成功，使用正常流程');
            }
        }, 500);
    </script>
</body>
</html>