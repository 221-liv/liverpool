<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è¯Šæ–­é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        button {
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #log {
            background: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è®¡ç®—å™¨åŠŸèƒ½è¯Šæ–­</h1>
    
    <div class="test-section">
        <h3>1. æ–‡ä»¶åŠ è½½æ£€æµ‹</h3>
        <div id="file-check"></div>
    </div>
    
    <div class="test-section">
        <h3>2. DOMå…ƒç´ æ£€æµ‹</h3>
        <div id="dom-check"></div>
    </div>
    
    <div class="test-section">
        <h3>3. åŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="testCalculation()">æµ‹è¯•è®¡ç®—åŠŸèƒ½</button>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="test-result" style="margin-top: 15px;"></div>
    </div>
    
    <div class="test-section">
        <h3>4. æ§åˆ¶å°æ—¥å¿—</h3>
        <div id="log"></div>
    </div>
    
    <!-- åŠ è½½æ‰€æœ‰JSæ–‡ä»¶ -->
    <script src="js/constants.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/footprint-calculator.js"></script>
    <script src="js/main.js"></script>
    
    <script>
        // æ—¥å¿—æ”¶é›†
        const logs = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            logs.push(['LOG', ...args]);
            updateLogDisplay();
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push(['ERROR', ...args]);
            updateLogDisplay();
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            logs.push(['WARN', ...args]);
            updateLogDisplay();
            originalWarn.apply(console, args);
        };
        
        function updateLogDisplay() {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = logs.map(log => {
                const type = log[0];
                const msg = log.slice(1).map(item => {
                    if (typeof item === 'object') {
                        return JSON.stringify(item, null, 2);
                    }
                    return String(item);
                }).join(' ');
                
                let color = '#000';
                if (type === 'ERROR') color = '#dc3545';
                if (type === 'WARN') color = '#ffc107';
                
                return `<div style="color: ${color}; margin: 3px 0;">[${type}] ${msg}</div>`;
            }).join('');
            
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            logs.length = 0;
            updateLogDisplay();
        }
        
        // æ£€æŸ¥æ–‡ä»¶åŠ è½½
        function checkFiles() {
            const fileCheckDiv = document.getElementById('file-check');
            let html = '';
            
            const checks = [
                { name: 'EMISSION_FACTORS', obj: window.EMISSION_FACTORS },
                { name: 'TRANSPORT_OPTIONS', obj: window.TRANSPORT_OPTIONS },
                { name: 'DIET_OPTIONS', obj: window.DIET_OPTIONS },
                { name: 'utils', obj: window.utils },
                { name: 'carbonCalculator', obj: window.carbonCalculator },
                { name: 'Calculator', obj: window.Calculator }
            ];
            
            checks.forEach(check => {
                const exists = typeof check.obj !== 'undefined';
                const className = exists ? 'success' : 'error';
                const icon = exists ? 'âœ…' : 'âŒ';
                html += `<div class="status ${className}">${icon} ${check.name}: ${exists ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}</div>`;
            });
            
            fileCheckDiv.innerHTML = html;
        }
        
        // æ£€æŸ¥DOMå…ƒç´ 
        function checkDOM() {
            const domCheckDiv = document.getElementById('dom-check');
            let html = '';
            
            // æ³¨æ„ï¼šå½“å‰é¡µé¢æ²¡æœ‰è¿™äº›å…ƒç´ ï¼Œè¿™æ˜¯æ­£å¸¸çš„
            html += '<div class="status info">â„¹ï¸ å½“å‰é¡µé¢æ˜¯è¯Šæ–­é¡µé¢ï¼Œä¸åŒ…å«è®¡ç®—å™¨å…ƒç´ ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼‰</div>';
            html += '<div class="status info">ğŸ“ ä»¥ä¸‹æ£€æŸ¥åº”è¯¥åœ¨ calculator.html é¡µé¢è¿›è¡Œï¼š</div>';
            
            const elements = [
                'calculate-btn',
                'transport-type-1',
                'distance-1',
                'food-type-1',
                'food-amount-1',
                'results-section'
            ];
            
            elements.forEach(id => {
                const elem = document.getElementById(id);
                const exists = elem !== null;
                const className = 'info';
                const icon = exists ? 'âœ…' : 'âš ï¸';
                html += `<div class="status ${className}">${icon} #${id}: ${exists ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨ï¼ˆè¯Šæ–­é¡µé¢æ— æ­¤å…ƒç´ ï¼‰'}</div>`;
            });
            
            domCheckDiv.innerHTML = html;
        }
        
        // æµ‹è¯•è®¡ç®—åŠŸèƒ½
        function testCalculation() {
            const resultDiv = document.getElementById('test-result');
            console.log('========== å¼€å§‹åŠŸèƒ½æµ‹è¯• ==========');
            
            try {
                // æµ‹è¯•æ•°æ®
                const testData = {
                    type: 'transportation',
                    item1: 'car_medium',
                    amount1: 10,
                    item2: 'subway',
                    amount2: 10
                };
                
                console.log('æµ‹è¯•æ•°æ®:', testData);
                
                // è·å–æ’æ”¾å› å­
                if (!window.EMISSION_FACTORS) {
                    throw new Error('EMISSION_FACTORS æœªå®šä¹‰');
                }
                
                const factors = window.EMISSION_FACTORS[testData.type];
                if (!factors) {
                    throw new Error(`æœªæ‰¾åˆ° ${testData.type} çš„æ’æ”¾å› å­`);
                }
                
                const factor1 = factors[testData.item1];
                const factor2 = factors[testData.item2];
                
                console.log('æ’æ”¾å› å­1:', factor1);
                console.log('æ’æ”¾å› å­2:', factor2);
                
                if (typeof factor1 !== 'number' || typeof factor2 !== 'number') {
                    throw new Error('æ’æ”¾å› å­ä¸æ˜¯æ•°å­—');
                }
                
                // è®¡ç®—æ’æ”¾é‡
                const emission1 = testData.amount1 * factor1;
                const emission2 = testData.amount2 * factor2;
                const savings = Math.abs(emission1 - emission2);
                const trees = (savings / 21.77).toFixed(2);
                
                console.log('æ’æ”¾é‡1:', emission1, 'kg COâ‚‚e');
                console.log('æ’æ”¾é‡2:', emission2, 'kg COâ‚‚e');
                console.log('å‡æ’é‡:', savings, 'kg COâ‚‚e');
                console.log('ç›¸å½“äºæ ‘æœ¨:', trees, 'æ£µ');
                
                resultDiv.innerHTML = `
                    <div class="status success">
                        <strong>âœ… è®¡ç®—åŠŸèƒ½æ­£å¸¸ï¼</strong><br><br>
                        <strong>æµ‹è¯•åœºæ™¯ï¼š</strong>10å…¬é‡Œé€šå‹¤å¯¹æ¯”<br>
                        â€¢ ä¸­å‹æ±½è½¦ï¼š${emission1.toFixed(3)} kg COâ‚‚e<br>
                        â€¢ åœ°é“ï¼š${emission2.toFixed(3)} kg COâ‚‚e<br>
                        â€¢ å‡æ’é‡ï¼š${savings.toFixed(3)} kg COâ‚‚e<br>
                        â€¢ ç›¸å½“äºç§æ¤ï¼š${trees} æ£µæ ‘
                    </div>
                `;
                
                console.log('âœ… æµ‹è¯•é€šè¿‡');
                
            } catch (error) {
                console.error('âŒ æµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div class="status error">
                        <strong>âŒ æµ‹è¯•å¤±è´¥</strong><br><br>
                        é”™è¯¯ä¿¡æ¯: ${error.message}<br>
                        é”™è¯¯å †æ ˆ: ${error.stack}
                    </div>
                `;
            }
            
            console.log('========== æµ‹è¯•ç»“æŸ ==========');
        }
        
        // é¡µé¢åŠ è½½åæ‰§è¡Œæ£€æŸ¥
        window.addEventListener('DOMContentLoaded', function() {
            console.log('è¯Šæ–­é¡µé¢å·²åŠ è½½');
            setTimeout(() => {
                checkFiles();
                checkDOM();
            }, 500);
        });
    </script>
</body>
</html>
