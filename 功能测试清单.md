# 功能测试清单 - 登录状态和记录功能优化

## 测试环境准备
- [ ] 清除浏览器缓存和localStorage
- [ ] 打开浏览器开发者工具（F12）
- [ ] 打开Console查看日志

---

## 一、登录状态持久化测试

### ✅ 测试1.1: 首次登录
- [ ] 访问 `login.html`
- [ ] 输入姓名："测试用户"
- [ ] 输入学号："20251001"
- [ ] 点击"登录"
- [ ] **验证点1**: 自动跳转到首页
- [ ] **验证点2**: 导航栏显示"退出(测试用户)"
- [ ] **验证点3**: Console输出"✅ 用户登录成功: 测试用户"

**预期结果**: ✅ 所有验证点通过

---

### ✅ 测试1.2: 刷新页面后状态保持
- [ ] 在登录状态下，按F5刷新页面
- [ ] **验证点1**: 页面刷新后仍显示"退出(测试用户)"
- [ ] **验证点2**: 不需要重新登录
- [ ] **验证点3**: Console输出"✅ 获取到登录用户: 测试用户"

**预期结果**: ✅ 登录状态保持，UI正常显示

---

### ✅ 测试1.3: 关闭浏览器后重新打开
- [ ] 完全关闭浏览器
- [ ] 重新打开浏览器
- [ ] 访问网站任意页面
- [ ] **验证点1**: 导航栏显示"退出(测试用户)"
- [ ] **验证点2**: 无需重新登录

**预期结果**: ✅ 登录状态持久化成功

---

### ✅ 测试1.4: 跨标签页状态同步
- [ ] 标签页A：打开网站（登录状态）
- [ ] 标签页B：打开网站（新标签页）
- [ ] **验证点1**: 标签页B自动识别登录状态
- [ ] **验证点2**: 两个标签页导航栏显示一致
- [ ] 在标签页A点击"退出"
- [ ] **验证点3**: 标签页B检测到状态变化（通过storage事件）

**预期结果**: ✅ 跨标签页状态同步

---

### ✅ 测试1.5: 退出登录
- [ ] 点击"退出(测试用户)"
- [ ] 确认退出
- [ ] **验证点1**: 页面刷新
- [ ] **验证点2**: 导航栏显示"登录"
- [ ] **验证点3**: Console输出"✅ 用户退出登录"

**预期结果**: ✅ 退出成功，切换为访客模式

---

## 二、记录功能测试

### ✅ 测试2.1: 访客模式记录保存
- [ ] 确保未登录（访客模式）
- [ ] 访问 `calculator.html`
- [ ] 选择交通方式：公交车，距离10km
- [ ] 选择对比方式：地铁，距离10km
- [ ] 点击"开始计算"
- [ ] **验证点1**: 显示计算结果
- [ ] **验证点2**: 右上角弹出绿色通知"记录已保存（访客模式）"
- [ ] **验证点3**: Console输出"✅ 记录已保存到访客记录"
- [ ] 访问 `records.html`
- [ ] **验证点4**: 页面标题显示"个人碳足迹记录（访客模式）"
- [ ] **验证点5**: 显示蓝色提示框
- [ ] **验证点6**: 表格中显示刚才的计算记录
- [ ] **验证点7**: 学号列显示"访客"

**预期结果**: ✅ 访客记录正常保存和显示

---

### ✅ 测试2.2: 用户模式记录保存
- [ ] 登录（姓名：张三，学号：20251002）
- [ ] 访问 `calculator.html`
- [ ] 选择食品：牛肉，1kg
- [ ] 选择对比：鸡肉，1kg
- [ ] 点击"开始计算"
- [ ] **验证点1**: 显示计算结果
- [ ] **验证点2**: 右上角弹出通知"记录已保存！张三"
- [ ] **验证点3**: Console输出"✅ 记录已保存到用户记录: 张三"
- [ ] 访问 `records.html`
- [ ] **验证点4**: 页面标题显示"张三的碳足迹记录"
- [ ] **验证点5**: 表格中显示记录
- [ ] **验证点6**: 学号列显示"20251002"
- [ ] **验证点7**: 记录中包含姓名"张三"

**预期结果**: ✅ 用户记录正常保存，信息关联正确

---

### ✅ 测试2.3: 记录数据完整性
- [ ] 完成一次计算
- [ ] 打开Console，输入：`RecordManager.getCurrentUserRecords()`
- [ ] 查看最新的记录对象
- [ ] **验证点1**: 包含 `studentId` 字段
- [ ] **验证点2**: 包含 `userName` 字段
- [ ] **验证点3**: 包含 `activityType` 字段
- [ ] **验证点4**: 包含 `option1Label, option1Amount, option1Emission`
- [ ] **验证点5**: 包含 `option2Label, option2Amount, option2Emission`
- [ ] **验证点6**: 包含 `totalEmission` 字段
- [ ] **验证点7**: 包含 `savings` 字段
- [ ] **验证点8**: 包含 `timestamp` 字段

**预期结果**: ✅ 记录数据结构完整

---

### ✅ 测试2.4: 访客转用户记录隔离
- [ ] 访客模式下完成2次计算
- [ ] 查看"个人记录"，记录数量：2
- [ ] 登录（姓名：李四，学号：20251003）
- [ ] **验证点1**: "个人记录"页面显示"李四的碳足迹记录"
- [ ] **验证点2**: 记录数量为0（不显示访客记录）
- [ ] 完成1次新计算
- [ ] **验证点3**: "个人记录"显示1条记录（李四的）
- [ ] 退出登录
- [ ] **验证点4**: "个人记录"显示2条记录（访客的）

**预期结果**: ✅ 访客记录和用户记录正确隔离

---

### ✅ 测试2.5: 多次计算记录累积
- [ ] 登录用户模式
- [ ] 完成5次不同的计算
- [ ] 访问"个人记录"
- [ ] **验证点1**: 显示5条记录
- [ ] **验证点2**: 按时间倒序排列（最新在前）
- [ ] **验证点3**: 统计卡片正确显示总记录数
- [ ] **验证点4**: 统计卡片正确显示总排放量
- [ ] **验证点5**: 统计卡片正确显示平均排放量

**预期结果**: ✅ 记录正确累积和统计

---

## 三、UI显示测试

### ✅ 测试3.1: 导航栏状态显示
**未登录时：**
- [ ] **验证点1**: 显示"登录"链接
- [ ] **验证点2**: 不显示"退出"按钮

**已登录时：**
- [ ] **验证点3**: 不显示"登录"链接
- [ ] **验证点4**: 显示"退出(用户名)"按钮
- [ ] **验证点5**: 用户名正确显示

**预期结果**: ✅ 导航栏状态正确切换

---

### ✅ 测试3.2: 保存通知显示
**访客模式：**
- [ ] 完成计算
- [ ] **验证点1**: 通知显示"记录已保存（访客模式）"
- [ ] **验证点2**: 通知包含"个人记录"链接
- [ ] **验证点3**: 通知包含"登录"提示链接
- [ ] **验证点4**: 5秒后自动消失

**用户模式：**
- [ ] 完成计算
- [ ] **验证点5**: 通知显示"记录已保存！[用户名]"
- [ ] **验证点6**: 通知包含"个人记录"链接
- [ ] **验证点7**: 5秒后自动消失

**预期结果**: ✅ 通知显示正确且动画流畅

---

### ✅ 测试3.3: 个人记录页面提示
**访客模式：**
- [ ] 访问 `records.html`
- [ ] **验证点1**: 标题显示"个人碳足迹记录（访客模式）"
- [ ] **验证点2**: 显示蓝色提示框
- [ ] **验证点3**: 提示内容包含"登录"链接

**用户模式：**
- [ ] 登录后访问 `records.html`
- [ ] **验证点4**: 标题显示"[用户名]的碳足迹记录"
- [ ] **验证点5**: 不显示蓝色提示框

**预期结果**: ✅ 页面提示根据登录状态正确显示

---

## 四、管理员功能测试

### ✅ 测试4.1: 管理员登录
- [ ] 访问 `admin.html`
- [ ] 输入用户名："王榆腾"
- [ ] 输入密码："351027"
- [ ] 点击"登录"
- [ ] **验证点1**: 登录成功，显示仪表盘
- [ ] **验证点2**: 显示统计卡片（用户数、记录数、总排放、平均排放）

**预期结果**: ✅ 管理员登录成功

---

### ✅ 测试4.2: 查看所有记录
- [ ] 在管理员后台
- [ ] **验证点1**: 用户列表显示所有用户
- [ ] **验证点2**: 包含访客统计
- [ ] **验证点3**: 数据按排放量降序排列
- [ ] **验证点4**: 显示用户名、学号、总排放量、最后更新时间

**预期结果**: ✅ 所有用户和访客数据正确显示

---

### ✅ 测试4.3: CSV导出（乱码修复验证）
- [ ] 点击"导出班级数据 (CSV)"
- [ ] 下载CSV文件
- [ ] 用Excel打开文件
- [ ] **验证点1**: 中文正常显示（无乱码）
- [ ] **验证点2**: 表头完整（时间、学号、姓名等）
- [ ] **验证点3**: 数据行完整
- [ ] **验证点4**: 包含所有用户和访客的记录

**预期结果**: ✅ CSV导出无乱码，数据完整

---

## 五、边界情况测试

### ✅ 测试5.1: 无记录时的显示
- [ ] 清除所有记录（Console: `localStorage.clear()`）
- [ ] 访问 `records.html`
- [ ] **验证点1**: 显示"暂无记录"提示
- [ ] **验证点2**: 提示包含"计算器"链接
- [ ] **验证点3**: 统计显示 0 记录、0.00 kg

**预期结果**: ✅ 空记录状态正确处理

---

### ✅ 测试5.2: LocalStorage禁用情况
- [ ] 在浏览器设置中禁用Cookie和网站数据
- [ ] 访问网站
- [ ] **验证点1**: 页面正常加载
- [ ] **验证点2**: Console显示错误但不崩溃
- [ ] **验证点3**: 降级方案启用

**预期结果**: ✅ 降级方案正常工作

---

### ✅ 测试5.3: auth.js加载失败
- [ ] 在 `calculator.html` 中临时移除 `<script src="js/auth.js"></script>`
- [ ] 刷新页面
- [ ] **验证点1**: 计算功能仍然可用
- [ ] **验证点2**: Console显示使用降级方案
- [ ] **验证点3**: 记录仍能保存（通过localStorage）

**预期结果**: ✅ 降级方案确保基本功能可用

---

## 六、性能和体验测试

### ✅ 测试6.1: 页面加载速度
- [ ] 清除缓存
- [ ] 访问首页
- [ ] **验证点1**: 页面在2秒内完全加载
- [ ] **验证点2**: auth.js快速执行（Console日志）
- [ ] **验证点3**: UI无明显闪烁

**预期结果**: ✅ 页面加载流畅

---

### ✅ 测试6.2: 大量记录性能
- [ ] 手动添加100条记录到localStorage
- [ ] 访问 `records.html`
- [ ] **验证点1**: 页面正常加载
- [ ] **验证点2**: 表格渲染流畅
- [ ] **验证点3**: 统计计算正确

**预期结果**: ✅ 大量数据下性能良好

---

## 七、Console日志验证

### ✅ 测试7.1: 关键日志输出
打开Console，完成一次完整的登录→计算→查看记录流程，验证以下日志：

- [ ] `✅ 认证管理模块加载完成`
- [ ] `✅ 用户登录成功: [用户名]`
- [ ] `🔐 页面UI更新：已登录模式`
- [ ] `✅ 获取到登录用户: [用户名] [学号]`
- [ ] `✅ 记录已保存到用户记录: [用户名]`
- [ ] `✅ 通过RecordManager加载记录，数量: [数量]`

**预期结果**: ✅ 所有关键日志正确输出

---

## 测试总结

### 通过标准
- ✅ 所有核心功能测试通过
- ✅ 边界情况正确处理
- ✅ 降级方案工作正常
- ✅ 用户体验流畅
- ✅ 无明显bug或性能问题

### 已知限制
- ⚠️ 数据仅保存在本地浏览器
- ⚠️ 不支持跨设备同步
- ⚠️ 清除浏览器数据会丢失记录

---

**测试人员**: _____________
**测试日期**: _____________
**测试结果**: □ 通过  □ 部分通过  □ 未通过
**备注**: _____________________________________________

